<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BABEL_GEN_v5.5</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@900&family=Noto+Sans+SC:wght@900&family=Noto+Sans+JP:wght@900&family=Noto+Sans+KR:wght@900&family=Noto+Sans+Thai:wght@900&family=Noto+Sans+Arabic:wght@900&family=Noto+Sans+Devanagari:wght@900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #000; 
            --nav-h: 32px; 
            --p-base: 280px; 
            --ui-font: 'JetBrains Mono', monospace; 
            --accent: #fff;
            --dim: #444;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            background: var(--bg); 
            color: #fff; 
            font-family: var(--ui-font); 
            height: 100dvh; 
            width: 100vw; 
            overflow: hidden; 
            display: flex; 
            flex-direction: column; 
        }

        .global-font { 
            font-family: 'Inter', 'Noto Sans SC', 'Noto Sans JP', 'Noto Sans KR', 'Noto Sans Thai', 'Noto Sans Arabic', 'Noto Sans Devanagari', sans-serif; 
        }

        #navbar { 
            height: var(--nav-h); 
            background: #0a0a0a; 
            border-bottom: 1px solid #1a1a1a; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 0 10px; 
            flex-shrink: 0; 
            z-index: 1100; 
        }
        #toggle-btn { 
            background: #222; color: #fff; border: 1px solid #333; 
            width: 20px; height: 20px; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; font-size: 10px; 
        }
        .nav-version { color: var(--dim); font-weight: 700; letter-spacing: 1px; font-size: 9px; }

        #app-body { 
            display: flex; 
            flex: 1; 
            overflow: hidden; 
            position: relative; 
            width: 100%; 
        }

        /* 侧边栏优化 */
        #panel { 
            width: var(--p-base); 
            height: 100%; 
            background: #050505; 
            display: flex; 
            flex-direction: column; 
            flex-shrink: 0; 
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.2s;
            border-right: 1px solid #111;
            position: relative;
            z-index: 100;
        }
        #panel.collapsed { 
            margin-left: calc(var(--p-base) * -1);
            opacity: 0; 
            pointer-events: none;
        }

        .p-scroll { flex: 1; overflow-y: auto; padding: 16px; display: flex; flex-direction: column; gap: 14px; }
        
        #status-bar { 
            display: flex; align-items: center; gap: 6px; 
            font-size: 8px; font-weight: 700; color: var(--dim); 
            margin-top: 4px; letter-spacing: 0.5px;
        }
        #st-dot { 
            width: 5px; height: 5px; border-radius: 50%; 
            background: #555; transition: all 0.3s; 
        }
        #st-dot.active { background: #fff; box-shadow: 0 0 6px #fff; }

        .item { display: flex; flex-direction: column; gap: 6px; width: 100%; }
        .item.hidden { display: none; }
        label { color: var(--dim); font-weight: 700; text-transform: uppercase; font-size: 8px; display: flex; justify-content: space-between; }
        label span { color: var(--accent); }
        
        textarea, select { 
            background: #000; border: 1px solid #1a1a1a; color: #aaa; 
            padding: 8px; font-size: 10px; outline: none; font-family: inherit; width: 100%; 
        }

        input[type="range"] { appearance: none; background: transparent; height: 20px; cursor: pointer; }
        input[type="range"]::-webkit-slider-runnable-track { background: #1a1a1a; height: 4px; border-radius: 2px; }
        input[type="range"]::-webkit-slider-thumb { 
            appearance: none; height: 14px; width: 28px; 
            background: var(--accent); border-radius: 4px; 
            margin-top: -5px;
        }

        .color-group { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .color-input-wrap { display: flex; align-items: center; background: #000; border: 1px solid #1a1a1a; padding: 2px 6px; }
        input[type="color"] { appearance: none; border: none; background: none; width: 20px; height: 20px; cursor: pointer; }
        .color-label { font-size: 8px; color: #666; margin-left: 5px; }

        /* 画布区域：始终占据剩余空间 */
        #canvas-wrap { 
            flex: 1; 
            background: var(--bg); 
            overflow: hidden; 
            position: relative; 
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        #grid-canvas { 
            flex: 1; 
            width: 100%; 
            height: 100%; 
            overflow: hidden;
        }

        /* 预设样式 */
        .static-container { width: 100%; height: 100%; overflow-y: auto; padding: 40px 0; display: flex; flex-direction: column; align-items: center; gap: 15px; }
        .static-line { font-size: 24px; font-weight: 900; text-align: center; text-transform: uppercase; width: 90%; animation: blurCycle 5s ease-in-out infinite; line-height: 1.1; }
        
        @keyframes blurCycle { 0%, 100% { filter: blur(0px); opacity: 1; } 50% { filter: blur(5px); opacity: 0.3; } }

        .stream-container { display: flex; flex-direction: column; width: 100%; height: 100%; }
        .stream-row { flex: 1; display: flex; align-items: center; white-space: nowrap; overflow: hidden; border-bottom: 0.1px solid rgba(255,255,255,0.05); }
        .stream-track { display: flex; will-change: transform; }

        .grid-layout { display: grid; grid-template-columns: repeat(auto-fill, minmax(var(--cell-w), 1fr)); grid-auto-rows: minmax(var(--cell-h), 1fr); width: 100%; height: 100%; }

        .u { display: flex; align-items: center; justify-content: center; font-weight: 900; text-transform: uppercase; white-space: nowrap; padding: 0 10px; line-height: 1; overflow: hidden; }

        @keyframes sS { 0%, 100% { transform: scaleY(1); } 50% { transform: scaleY(var(--stretch-val)); } }
        @keyframes marqueeL { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        @keyframes marqueeR { 0% { transform: translateX(-50%); } 100% { transform: translateX(0); } }

        .export-section { background: #111; padding: 10px; border-radius: 4px; display: flex; flex-direction: column; gap: 8px; }
        .export-btn { background: #fff; color: #000; border: none; padding: 12px; font-weight: 900; font-size: 10px; cursor: pointer; transition: all 0.2s; text-align: center; }
        .export-btn:hover { background: #eee; }

        @media (max-width: 900px) {
            #app-body { flex-direction: column; }
            #panel { width: 100% !important; height: 40dvh; border-right: none; border-bottom: 1px solid #111; margin-left: 0; }
            #panel.collapsed { transform: translateY(-100%); height: 0 !important; margin-left: 0; }
            .p-scroll { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
            .full { grid-column: span 2; }
        }
    </style>
</head>
<body class="global-font">

    <nav id="navbar">
        <div id="nav-left"><button id="toggle-btn" onclick="toggleP()">✕</button></div>
        <div id="nav-right"><span class="nav-version">BABEL_GEN_v5.5</span></div>
    </nav>

    <div id="app-body">
        <aside id="panel">
            <div class="p-scroll">
                <div class="item full">
                    <label>CORE_INPUT</label>
                    <textarea id="in-text" rows="2">There are as many languages as there are people in the world.</textarea>
                    <div id="status-bar"><div id="st-dot" class="active"></div><span id="st-text">READY</span></div>
                </div>
                <div class="item full">
                    <label>PRESET</label>
                    <select id="in-mode">
                        <option value="default" selected>Static List (Default)</option>
                        <option value="swiss">Swiss Vertical</option>
                        <option value="kinetic">Kinetic Warp (Stream Engine)</option>
                    </select>
                </div>
                <div class="item ctrl-node hidden">
                    <label id="label-stretch">STRETCH <span>1</span></label>
                    <input type="range" id="in-stretch" min="0.1" max="1.0" step="0.05" value="1">
                </div>
                <div class="item ctrl-node hidden">
                    <label id="label-font">SCALE <span>2</span></label>
                    <input type="range" id="in-font" min="0.2" max="5.0" step="0.1" value="2">
                </div>
                <div class="item ctrl-node hidden">
                    <label id="label-rows">DENSITY <span>200</span></label>
                    <input type="range" id="in-rows" min="10" max="200" step="1" value="200">
                </div>
                <div class="item ctrl-node hidden">
                    <label id="label-seed">SEED <span>1</span></label>
                    <input type="range" id="in-seed" min="1" max="100" step="1" value="1">
                </div>
                <div class="item full">
                    <label>COLOR (TEXT / BG)</label>
                    <div class="color-group">
                        <div class="color-input-wrap"><input type="color" id="in-color-text" value="#ffffff"><span class="color-label">TXT</span></div>
                        <div class="color-input-wrap"><input type="color" id="in-color-bg" value="#000000"><span class="color-label">BG</span></div>
                    </div>
                </div>
                <div class="item full">
                    <label>EXPORT</label>
                    <div class="export-section">
                        <button class="export-btn" id="export-motion-btn" onclick="exportMotionCode()">Export Motion Code</button>
                    </div>
                </div>
            </div>
        </aside>
        
        <main id="canvas-wrap">
            <div id="grid-canvas"></div>
        </main>
    </div>

    <script>
    (function() {
        // 配置初始值修复：kinetic 现在默认为白色
        const PRESET_CONFIGS = {
            default: { hideControls: true, colorTxt: "#ffffff", colorBg: "#000000" },
            swiss: { stretch: 1.0, stretchMin: 0.1, stretchMax: 1.0, font: 2.0, rows: 200, seed: 1, labelStretch: "STRETCH", colorTxt: "#ffffff", colorBg: "#000000", hideControls: false },
            kinetic: { stretch: 0.1, stretchMin: 0.1, stretchMax: 10.0, font: 1.0, rows: 60, seed: 1, labelStretch: "FLOW_SPEED", colorTxt: "#ffffff", colorBg: "#000000", hideControls: false }
        };

        let pool = ["Loading..."];
        const panel = document.getElementById('panel');
        const canvas = document.getElementById('grid-canvas');
        const wrap = document.getElementById('canvas-wrap');
        
        window.toggleP = () => {
            const isC = panel.classList.toggle('collapsed');
            document.getElementById('toggle-btn').innerText = isC ? '⚙' : '✕';
            // 动画结束后触发重绘，确保容器尺寸已更新
            setTimeout(render, 310);
        };

        document.getElementById('in-mode').onchange = (e) => {
            const mode = e.target.value;
            const cfg = PRESET_CONFIGS[mode];
            document.querySelectorAll('.ctrl-node').forEach(node => {
                if(cfg.hideControls) node.classList.add('hidden');
                else node.classList.remove('hidden');
            });
            if(!cfg.hideControls) {
                const sInput = document.getElementById('in-stretch');
                sInput.min = cfg.stretchMin; sInput.max = cfg.stretchMax; sInput.value = cfg.stretch;
                document.getElementById('in-font').value = cfg.font;
                document.getElementById('in-rows').value = cfg.rows;
                document.getElementById('in-seed').value = cfg.seed;
                document.getElementById('label-stretch').firstChild.textContent = cfg.labelStretch + " ";
            }
            document.getElementById('in-color-text').value = cfg.colorTxt;
            document.getElementById('in-color-bg').value = cfg.colorBg;
            updateLabels(); render();
        };

        function updateLabels() {
            document.querySelector('#label-stretch span').innerText = document.getElementById('in-stretch').value;
            document.querySelector('#label-font span').innerText = document.getElementById('in-font').value;
            document.querySelector('#label-rows span').innerText = document.getElementById('in-rows').value;
            document.querySelector('#label-seed span').innerText = document.getElementById('in-seed').value;
        }

        ['in-stretch','in-font','in-seed','in-rows'].forEach(id => {
            document.getElementById(id).oninput = () => { updateLabels(); render(); };
        });
        ['in-color-text','in-color-bg'].forEach(id => {
            document.getElementById(id).oninput = render;
        });

        async function fetchL(text) {
            if(!text.trim()) return;
            document.getElementById('st-text').innerText = "TRANSLATING...";
            document.getElementById('st-dot').classList.remove('active');
            try {
                const langs = ['zh-CN','ja','ko','fr','de','ru','es','it','ar','hi','pt','tr','vi','pl','nl','sv','no','da','fi','el','he','id','ms','th','cs','hu','ro','sk','uk','bg','hr','lt','lv','et','sl','ga','is','sw','eo','la'];
                const res = await Promise.all(langs.map(async l => {
                    const r = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${l}&dt=t&q=${encodeURI(text)}`);
                    const d = await r.json(); return d[0][0][0];
                }));
                pool = [text, ...res];
                document.getElementById('st-text').innerText = "READY";
                document.getElementById('st-dot').classList.add('active');
            } catch (e) { 
                pool = [text]; 
                document.getElementById('st-text').innerText = "OFFLINE";
            }
            render();
        }

        function render() {
            const mode = document.getElementById('in-mode').value;
            const stretch = parseFloat(document.getElementById('in-stretch').value);
            const fontScale = parseFloat(document.getElementById('in-font').value);
            const density = parseInt(document.getElementById('in-rows').value);
            const seed = parseInt(document.getElementById('in-seed').value);
            const txtCol = document.getElementById('in-color-text').value;
            const bgCol = document.getElementById('in-color-bg').value;

            wrap.style.backgroundColor = bgCol;
            canvas.innerHTML = '';
            
            if (mode === 'default') {
                canvas.className = 'static-container';
                pool.forEach((word, idx) => {
                    const line = document.createElement('div');
                    line.className = 'static-line global-font';
                    line.style.color = txtCol;
                    line.style.animationDelay = (idx * 0.1) + 's';
                    line.innerText = word;
                    canvas.appendChild(line);
                });
            } else if (mode === 'kinetic') {
                canvas.className = 'stream-container';
                const canvasH = wrap.offsetHeight;
                const cellH = Math.max(2, canvasH / density);
                for (let r = 0; r < density; r++) {
                    const rowDiv = document.createElement('div');
                    rowDiv.className = 'stream-row';
                    const track = document.createElement('div');
                    track.className = 'stream-track';
                    let content = "";
                    for(let c = 0; c < 12; c++) {
                        const word = pool[(r + c + seed) % pool.length];
                        content += `<span class="u global-font" style="color:${txtCol}; font-size:${cellH * 0.8 * fontScale}px">${word}</span>`;
                    }
                    track.innerHTML = content + content;
                    const isEven = r % 2 === 0;
                    const duration = (1 / stretch) * 5 + (r % 3); 
                    track.style.animation = `${isEven ? 'marqueeL' : 'marqueeR'} ${duration}s linear infinite`;
                    rowDiv.appendChild(track);
                    canvas.appendChild(rowDiv);
                }
            } else {
                canvas.className = 'grid-layout';
                const cellSize = Math.max(10, 800 / density) * fontScale;
                canvas.style.setProperty('--cell-w', cellSize + 'px');
                canvas.style.setProperty('--cell-h', (cellSize * 0.6) + 'px');
                const totalCells = Math.min(500, density * 5);
                for (let i = 0; i < totalCells; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'u global-font';
                    cell.innerText = pool[(i + seed) % pool.length];
                    cell.style.color = txtCol;
                    cell.style.fontSize = (cellSize * 0.4) + "px";
                    cell.style.setProperty('--stretch-val', 1 + stretch * 2);
                    cell.style.animation = `sS ${1.5 + (i % 5) * 0.2}s ease-in-out infinite`;
                    canvas.appendChild(cell);
                }
            }
        }

        window.exportMotionCode = () => {
            const mode = document.getElementById('in-mode').value;
            const stretch = document.getElementById('in-stretch').value;
            const fontScale = document.getElementById('in-font').value;
            const density = document.getElementById('in-rows').value;
            const seed = document.getElementById('in-seed').value;
            const txtCol = document.getElementById('in-color-text').value;
            const bgCol = document.getElementById('in-color-bg').value;
            const textContent = JSON.stringify(pool);

            const code = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@900&family=Noto+Sans+SC:wght@900&family=Noto+Sans+JP:wght@900&family=Noto+Sans+KR:wght@900&family=Noto+Sans+Thai:wght@900&family=Noto+Sans+Arabic:wght@900&family=Noto+Sans+Devanagari:wght@900&display=swap" rel="stylesheet">
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: ${bgCol}; }
        .gf { font-family: 'Inter', 'Noto Sans SC', 'Noto Sans JP', 'Noto Sans KR', 'Noto Sans Thai', 'Noto Sans Arabic', 'Noto Sans Devanagari', sans-serif; }
        #v { width: 100%; height: 100%; display: flex; flex-direction: column; overflow: hidden; }
        .u { display: flex; align-items: center; justify-content: center; font-weight: 900; text-transform: uppercase; white-space: nowrap; padding: 0 10px; line-height: 1; overflow: hidden; }
        @keyframes sS { 0%, 100% { transform: scaleY(1); } 50% { transform: scaleY(var(--sv)); } }
        @keyframes mL { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        @keyframes mR { 0% { transform: translateX(-50%); } 100% { transform: translateX(0); } }
        @keyframes bC { 0%, 100% { filter: blur(0px); opacity: 1; } 50% { filter: blur(5px); opacity: 0.3; } }
        .si { font-size: 4vh; font-weight: 900; text-align: center; text-transform: uppercase; width: 90%; animation: bC 5s ease-in-out infinite; color: ${txtCol}; margin: 2vh auto; line-height: 1.1; }
        .sr { flex: 1; display: flex; align-items: center; white-space: nowrap; overflow: hidden; border-bottom: 0.1px solid rgba(255,255,255,0.05); }
        .st { display: flex; will-change: transform; }
        .gl { display: grid; grid-template-columns: repeat(auto-fill, minmax(var(--cw), 1fr)); grid-auto-rows: minmax(var(--ch), 1fr); width: 100%; height: 100%; }
    </style>
</head>
<body class="gf">
    <div id="v"></div>
    <script>
        const p = ${textContent};
        const v = document.getElementById('v');
        function d() {
            v.innerHTML = '';
            const m = "${mode}";
            if(m === 'default') {
                p.forEach((t, i) => {
                    const el = document.createElement('div'); el.className = 'si';
                    el.style.animationDelay = (i * 0.1) + 's'; el.innerText = t; v.appendChild(el);
                });
            } else if(m === 'kinetic') {
                const h = window.innerHeight; const de = ${density}; const fs = ${fontScale}; const st = ${stretch};
                const ch = Math.max(2, h / de);
                for(let r=0; r<de; r++) {
                    const row = document.createElement('div'); row.className = 'sr';
                    const tr = document.createElement('div'); tr.className = 'st';
                    let c = ""; for(let i=0; i<12; i++) {
                        const w = p[(r+i+${seed})%p.length];
                        c += \`<span class="u" style="color:${txtCol}; font-size:\${ch*0.8*fs}px">\${w}</span>\`;
                    }
                    tr.innerHTML = c + c;
                    tr.style.animation = \`\${r%2===0?'mL':'mR'} \${(1/st)*5+(r%3)}s linear infinite\`;
                    row.appendChild(tr); v.appendChild(row);
                }
            } else {
                v.className = 'gl'; const de = ${density}; const fs = ${fontScale}; const st = ${stretch};
                const cs = Math.max(10, 800/de) * fs;
                v.style.setProperty('--cw', cs+'px'); v.style.setProperty('--ch', (cs*0.6)+'px');
                for(let i=0; i<Math.min(500, de*5); i++) {
                    const c = document.createElement('div'); c.className = 'u';
                    c.innerText = p[(i+${seed})%p.length]; c.style.color = '${txtCol}';
                    c.style.fontSize = (cs*0.4)+'px'; c.style.setProperty('--sv', 1+st*2);
                    c.style.animation = \`sS \${1.5+(i%5)*0.2}s ease-in-out infinite\`;
                    v.appendChild(c);
                }
            }
        }
        window.addEventListener('resize', d); d();
    <\/script>
</body>
</html>`;

            const ta = document.createElement("textarea"); ta.value = code; document.body.appendChild(ta); ta.select();
            try {
                document.execCommand('copy');
                const btn = document.getElementById('export-motion-btn');
                btn.innerText = "COPIED TO CLIPBOARD!"; btn.style.background = "#fff";
                setTimeout(() => btn.innerText = "Export Motion Code", 2000);
            } catch (err) {}
            document.body.removeChild(ta);
        };

        document.getElementById('in-text').oninput = (e) => {
            clearTimeout(window.db);
            window.db = setTimeout(() => fetchL(e.target.value), 800);
        };

        window.addEventListener('resize', render);
        // 初始化
        document.getElementById('in-mode').dispatchEvent(new Event('change'));
        fetchL(document.getElementById('in-text').value);
    })();
    </script>
</body>
</html>