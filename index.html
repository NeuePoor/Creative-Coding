<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BABEL_GEN_v5.2</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@900&family=Noto+Sans+SC:wght@900&family=Noto+Sans+JP:wght@900&family=Noto+Sans+KR:wght@900&family=Noto+Sans+Thai:wght@900&family=Noto+Sans+Arabic:wght@900&family=Noto+Sans+Devanagari:wght@900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #000; 
            --nav-h: 32px; 
            --p-base: 260px; 
            --ui-font: 'JetBrains Mono', monospace; 
            --accent: #fff;
            --dim: #444;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            background: var(--bg); 
            color: #fff; 
            font-family: var(--ui-font); 
            height: 100dvh; 
            width: 100vw; 
            overflow: hidden; 
            display: flex; 
            flex-direction: column; 
        }

        .global-font { 
            font-family: 'Inter', 'Noto Sans SC', 'Noto Sans JP', 'Noto Sans KR', 'Noto Sans Thai', 'Noto Sans Arabic', 'Noto Sans Devanagari', sans-serif; 
        }

        #navbar { 
            height: var(--nav-h); 
            background: #0a0a0a; 
            border-bottom: 1px solid #1a1a1a; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 0 10px; 
            flex-shrink: 0; 
            z-index: 1100; 
        }
        #toggle-btn { 
            background: #222; color: #fff; border: 1px solid #333; 
            width: 18px; height: 18px; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; font-size: 10px; 
        }
        .nav-version { color: var(--dim); font-weight: 700; letter-spacing: 1px; font-size: 9px; }

        #app-body { display: flex; flex-grow: 1; overflow: hidden; position: relative; }

        #panel { 
            width: var(--p-base); height: 100%; background: #050505; 
            display: flex; flex-direction: column; flex-shrink: 0; 
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.3s;
            min-width: 240px;
            border-right: 1px solid #111;
            position: relative;
        }
        #panel.collapsed { transform: translateX(-100%); width: 0 !important; min-width: 0 !important; opacity: 0; pointer-events: none; }

        .p-scroll { flex-grow: 1; overflow-y: auto; padding: 16px; display: flex; flex-direction: column; gap: 14px; }
        
        #status-bar { 
            display: flex; align-items: center; gap: 6px; 
            font-size: 8px; font-weight: 700; color: var(--dim); 
            margin-top: 4px; letter-spacing: 0.5px;
        }
        #st-dot { 
            width: 5px; height: 5px; border-radius: 50%; 
            background: #555; transition: all 0.3s; 
        }
        #st-dot.active { background: #fff; box-shadow: 0 0 6px #fff; }

        .item { display: flex; flex-direction: column; gap: 6px; width: 100%; flex-shrink: 0; }
        label { color: var(--dim); font-weight: 700; text-transform: uppercase; font-size: 8px; display: flex; justify-content: space-between; }
        label span { color: var(--accent); }
        
        textarea, select { 
            background: #000; border: 1px solid #1a1a1a; color: #aaa; 
            padding: 8px; font-size: 9px; outline: none; font-family: inherit; width: 100%; 
        }

        input[type="range"] { appearance: none; background: transparent; height: 20px; cursor: pointer; }
        input[type="range"]::-webkit-slider-runnable-track { background: #1a1a1a; height: 4px; border-radius: 2px; }
        input[type="range"]::-webkit-slider-thumb { 
            appearance: none; height: 14px; width: 28px; 
            background: var(--accent); border-radius: 4px; 
            margin-top: -5px; transition: transform 0.1s;
        }

        .color-group { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .color-input-wrap { display: flex; align-items: center; background: #000; border: 1px solid #1a1a1a; padding: 2px 6px; }
        input[type="color"] { appearance: none; border: none; background: none; width: 20px; height: 20px; cursor: pointer; }
        .color-label { font-size: 8px; color: #666; margin-left: 5px; }

        #resizer { width: 3px; background: #111; cursor: col-resize; z-index: 10; }

        #canvas-wrap { flex-grow: 1; background: var(--bg); overflow-y: auto; position: relative; min-width: 0; scroll-behavior: smooth; }
        
        #grid-canvas { width: 100%; height: auto; min-height: 100%; }

        /* Kinetic Engine Styles */
        .stream-container { display: flex; flex-direction: column; width: 100%; height: 100%; overflow: hidden; }
        .stream-row { flex: 1; display: flex; align-items: center; white-space: nowrap; overflow: hidden; border-bottom: 0.1px solid rgba(255,255,255,0.05); }
        .stream-track { display: flex; will-change: transform; }

        /* Swiss Engine Styles: Vertical List with Multi-Column Support */
        .swiss-grid {
            display: grid;
            width: 100%;
            height: auto;
            gap: 0;
        }

        .swiss-unit {
            display: flex;
            flex-direction: column;
            width: 100%;
            border: 0.1px solid rgba(255,255,255,0.05);
            padding: 20px 0;
        }

        .u { 
            display: flex; align-items: center; justify-content: center; 
            font-weight: 900; text-transform: uppercase; white-space: nowrap; 
            line-height: 1.1; width: 100%;
        }

        @keyframes sS { 0%, 100% { transform: scaleY(1); } 50% { transform: scaleY(var(--stretch-val)); } }
        @keyframes marqueeL { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        @keyframes marqueeR { 0% { transform: translateX(-50%); } 100% { transform: translateX(0); } }

        #export-btn { background: #fff; color: #000; border: none; padding: 10px; font-weight: 900; font-size: 9px; cursor: pointer; margin-top: 5px; transition: opacity 0.2s; }
        #export-btn:active { opacity: 0.7; }

        @media (max-width: 900px) {
            #app-body { flex-direction: column; }
            #panel { width: 100% !important; height: 40vh; border-right: none; border-bottom: 1px solid #111; }
            .p-scroll { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 12px; }
            .full { grid-column: span 2; }
        }
    </style>
</head>
<body class="global-font">

    <nav id="navbar">
        <div id="nav-left"><button id="toggle-btn" onclick="toggleP()">✕</button></div>
        <div id="nav-right"><span class="nav-version">BABEL_GEN_v5.2</span></div>
    </nav>

    <div id="app-body">
        <aside id="panel">
            <div class="p-scroll">
                <div class="item full">
                    <label>CORE_INPUT</label>
                    <textarea id="in-text" rows="2">There are as many languages as there are people in the world.</textarea>
                    <div id="status-bar"><div id="st-dot" class="active"></div><span id="st-text">READY</span></div>
                </div>
                <div class="item full">
                    <label>PRESET</label>
                    <select id="in-mode">
                        <option value="swiss" selected>Swiss Vertical</option>
                        <option value="kinetic">Kinetic Warp (Stream Engine)</option>
                    </select>
                </div>
                <div class="item">
                    <label id="label-stretch">STRETCH <span>0.1</span></label>
                    <input type="range" id="in-stretch" min="0.1" max="1.0" step="0.05" value="0.1">
                </div>
                <div class="item">
                    <label id="label-font">SCALE <span>1.0</span></label>
                    <input type="range" id="in-font" min="0.1" max="10.0" step="0.1" value="1.0">
                </div>
                <div class="item">
                    <label id="label-rows">COLUMNS <span>1</span></label>
                    <input type="range" id="in-rows" min="1" max="6" step="1" value="1">
                </div>
                <div class="item">
                    <label id="label-seed">SEED <span>1</span></label>
                    <input type="range" id="in-seed" min="1" max="100" step="1" value="1">
                </div>
                <div class="item full">
                    <label>COLOR (TEXT / BG)</label>
                    <div class="color-group">
                        <div class="color-input-wrap"><input type="color" id="in-color-text" value="#ffffff"><span class="color-label">TXT</span></div>
                        <div class="color-input-wrap"><input type="color" id="in-color-bg" value="#000000"><span class="color-label">BG</span></div>
                    </div>
                </div>
                <div class="item full">
                    <button id="export-btn" onclick="copyDynamicEmbed()">EXPORT_DYNAMIC_EMBED</button>
                </div>
            </div>
        </aside>
        
        <div id="resizer"></div>
        <main id="canvas-wrap">
            <div id="grid-canvas"></div>
        </main>
    </div>

    <script>
    (function() {
        const PRESET_CONFIGS = {
            swiss: {
                stretch: 0.1, 
                stretchMin: 0.1, stretchMax: 1.0,
                font: 1.0,    
                rows: 1,      // In Swiss mode, this is Columns
                rowsMin: 1, rowsMax: 6,
                seed: 1,      
                labelStretch: "STRETCH",
                labelDensity: "COLUMNS",
                colorTxt: "#ffffff", colorBg: "#000000"
            },
            kinetic: {
                stretch: 0.1, 
                stretchMin: 0.1, stretchMax: 10.0,
                font: 1.0,    
                rows: 60,     // In Kinetic mode, this is Row Count
                rowsMin: 10, rowsMax: 200,
                seed: 1,      
                labelStretch: "FLOW_SPEED",
                labelDensity: "DENSITY",
                colorTxt: "#ffffff", colorBg: "#000000"
            }
        };

        let pool = ["Connecting Babel..."];
        const panel = document.getElementById('panel');
        const resizer = document.getElementById('resizer');
        const canvas = document.getElementById('grid-canvas');
        const wrap = document.getElementById('canvas-wrap');
        
        let isResizing = false;

        resizer.addEventListener('mousedown', () => isResizing = true);
        window.addEventListener('mousemove', (e) => {
            if (!isResizing) return;
            if (window.innerWidth > 900) {
                panel.style.width = Math.max(200, Math.min(e.clientX, window.innerWidth * 0.7)) + 'px';
            }
            render();
        });
        window.addEventListener('mouseup', () => isResizing = false);

        window.toggleP = () => {
            const isC = panel.classList.toggle('collapsed');
            document.getElementById('toggle-btn').innerText = isC ? '⚙' : '✕';
            setTimeout(render, 400);
        };

        document.getElementById('in-mode').onchange = (e) => {
            const mode = e.target.value;
            const cfg = PRESET_CONFIGS[mode];
            
            const sInput = document.getElementById('in-stretch');
            sInput.min = cfg.stretchMin;
            sInput.max = cfg.stretchMax;
            sInput.value = cfg.stretch;

            const dInput = document.getElementById('in-rows');
            dInput.min = cfg.rowsMin;
            dInput.max = cfg.rowsMax;
            dInput.value = cfg.rows;
            
            document.getElementById('in-font').value = cfg.font;
            document.getElementById('in-seed').value = cfg.seed;
            document.getElementById('label-stretch').firstChild.textContent = cfg.labelStretch + " ";
            document.getElementById('label-rows').firstChild.textContent = cfg.labelDensity + " ";
            
            updateLabels();
            render();
        };

        function updateLabels() {
            document.querySelector('#label-stretch span').innerText = document.getElementById('in-stretch').value;
            document.querySelector('#label-font span').innerText = document.getElementById('in-font').value;
            document.querySelector('#label-rows span').innerText = document.getElementById('in-rows').value;
            document.querySelector('#label-seed span').innerText = document.getElementById('in-seed').value;
        }

        ['in-stretch','in-font','in-seed','in-rows'].forEach(id => {
            document.getElementById(id).oninput = () => { updateLabels(); render(); };
        });
        ['in-color-text','in-color-bg'].forEach(id => {
            document.getElementById(id).oninput = render;
        });

        async function fetchL(text) {
            if(!text.trim()) return;
            document.getElementById('st-text').innerText = "TRANSLATING_40";
            document.getElementById('st-dot').classList.remove('active');
            
            try {
                const langs = ['zh-CN','ja','ko','fr','de','ru','es','it','ar','hi','pt','tr','vi','pl','nl','sv','no','da','fi','el','he','id','ms','th','cs','hu','ro','sk','uk','bg','hr','lt','lv','et','sl','ga','is','sw','eo','la'];
                const res = await Promise.all(langs.map(async l => {
                    const r = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${l}&dt=t&q=${encodeURI(text)}`);
                    const d = await r.json(); return d[0][0][0];
                }));
                pool = [text, ...res];
                document.getElementById('st-text').innerText = "READY (40 LANGS)";
                document.getElementById('st-dot').classList.add('active');
            } catch (e) { 
                pool = [text, "Translation Error"]; 
                document.getElementById('st-text').innerText = "ERROR";
            }
            render();
        }

        function render() {
            const mode = document.getElementById('in-mode').value;
            const stretch = parseFloat(document.getElementById('in-stretch').value);
            const fontScale = parseFloat(document.getElementById('in-font').value);
            const density = parseInt(document.getElementById('in-rows').value);
            const seed = parseInt(document.getElementById('in-seed').value);
            const txtCol = document.getElementById('in-color-text').value;
            const bgCol = document.getElementById('in-color-bg').value;

            wrap.style.backgroundColor = bgCol;
            canvas.innerHTML = '';
            
            if (mode === 'kinetic') {
                wrap.style.overflowY = 'hidden';
                canvas.className = 'stream-container';
                canvas.style.display = 'flex';
                const canvasH = wrap.offsetHeight;
                const cellH = canvasH / density;
                
                for (let r = 0; r < density; r++) {
                    const rowDiv = document.createElement('div');
                    rowDiv.className = 'stream-row';
                    const track = document.createElement('div');
                    track.className = 'stream-track';
                    let content = "";
                    for(let c = 0; c < 12; c++) {
                        const word = pool[(r + c + seed) % pool.length];
                        content += `<span class="u global-font" style="color:${txtCol}; font-size:${cellH * 0.8 * fontScale}px">${word}</span>`;
                    }
                    track.innerHTML = content + content;
                    const isEven = r % 2 === 0;
                    const duration = (1 / stretch) * 5 + (r % 3); 
                    track.style.animation = `${isEven ? 'marqueeL' : 'marqueeR'} ${duration}s linear infinite`;
                    rowDiv.appendChild(track);
                    canvas.appendChild(rowDiv);
                }
            } else {
                // Swiss Vertical: Vertical List Layout
                wrap.style.overflowY = 'auto';
                canvas.className = 'swiss-grid';
                canvas.style.display = 'grid';
                canvas.style.gridTemplateColumns = `repeat(${density}, 1fr)`;
                
                // We create 'density' number of columns, each containing the full 40 translations
                for (let colIdx = 0; colIdx < density; colIdx++) {
                    const unit = document.createElement('div');
                    unit.className = 'swiss-unit';
                    
                    pool.forEach((txt, idx) => {
                        const span = document.createElement('span');
                        span.className = 'u global-font';
                        span.innerText = txt;
                        span.style.color = txtCol;
                        
                        // Font size logic: Responsive to column count and scale
                        const baseFontSize = (wrap.offsetWidth / density / 10) * fontScale;
                        span.style.fontSize = baseFontSize + "px";
                        
                        // Stretch logic
                        span.style.setProperty('--stretch-val', 1 + stretch * 3);
                        const animDuration = 0.8 + ((idx + colIdx + seed) % 5) * 0.4;
                        span.style.animation = `sS ${animDuration}s ease-in-out infinite`;
                        
                        unit.appendChild(span);
                    });
                    canvas.appendChild(unit);
                }
            }
        }

        window.copyDynamicEmbed = () => { 
            const btn = document.getElementById('export-btn');
            btn.innerText = "COPIED_T0_CLIPBOARD";
            setTimeout(() => btn.innerText = "EXPORT_DYNAMIC_EMBED", 2000);
        };

        document.getElementById('in-text').oninput = (e) => {
            clearTimeout(window.db);
            window.db = setTimeout(() => fetchL(e.target.value), 800);
        };

        window.addEventListener('resize', render);
        document.getElementById('in-mode').dispatchEvent(new Event('change'));
        fetchL(document.getElementById('in-text').value);
    })();
    </script>
</body>
</html>