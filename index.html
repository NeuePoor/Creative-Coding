<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BABEL_GEN_v5.2</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@900&family=Noto+Sans+SC:wght@900&family=Noto+Sans+JP:wght@900&family=Noto+Sans+KR:wght@900&family=Noto+Sans+Thai:wght@900&family=Noto+Sans+Arabic:wght@900&family=Noto+Sans+Devanagari:wght@900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #000; 
            --nav-h: 32px; 
            --p-base: 260px; 
            --ui-font: 'JetBrains Mono', monospace; 
            --accent: #fff;
            --dim: #444;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            background: var(--bg); 
            color: #fff; 
            font-family: var(--ui-font); 
            height: 100dvh; 
            width: 100vw; 
            overflow: hidden; 
            display: flex; 
            flex-direction: column; 
        }

        .global-font { 
            font-family: 'Inter', 'Noto Sans SC', 'Noto Sans JP', 'Noto Sans KR', 'Noto Sans Thai', 'Noto Sans Arabic', 'Noto Sans Devanagari', sans-serif; 
        }

        #navbar { 
            height: var(--nav-h); 
            background: #0a0a0a; 
            border-bottom: 1px solid #1a1a1a; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 0 10px; 
            flex-shrink: 0; 
            z-index: 1100; 
        }
        #toggle-btn { 
            background: #222; color: #fff; border: 1px solid #333; 
            width: 18px; height: 18px; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; font-size: 10px; 
        }
        .nav-version { color: var(--dim); font-weight: 700; letter-spacing: 1px; font-size: 9px; }

        #app-body { display: flex; flex-grow: 1; overflow: hidden; position: relative; }

        #panel { 
            width: var(--p-base); height: 100%; background: #050505; 
            display: flex; flex-direction: column; flex-shrink: 0; 
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.3s;
            min-width: 240px;
            border-right: 1px solid #111;
            position: relative;
        }
        #panel.collapsed { transform: translateX(-100%); width: 0 !important; min-width: 0 !important; opacity: 0; pointer-events: none; }

        .p-scroll { flex-grow: 1; overflow-y: auto; padding: 16px; display: flex; flex-direction: column; gap: 14px; }
        
        #status-bar { 
            display: flex; align-items: center; gap: 6px; 
            font-size: 8px; font-weight: 700; color: var(--dim); 
            margin-top: 4px; letter-spacing: 0.5px;
        }
        #st-dot { 
            width: 5px; height: 5px; border-radius: 50%; 
            background: #555; transition: all 0.3s; 
        }
        #st-dot.active { background: #fff; box-shadow: 0 0 6px #fff; }

        .item { display: flex; flex-direction: column; gap: 6px; width: 100%; flex-shrink: 0; }
        .item.hidden { display: none; }
        label { color: var(--dim); font-weight: 700; text-transform: uppercase; font-size: 8px; display: flex; justify-content: space-between; }
        label span { color: var(--accent); }
        
        textarea, select { 
            background: #000; border: 1px solid #1a1a1a; color: #aaa; 
            padding: 8px; font-size: 9px; outline: none; font-family: inherit; width: 100%; 
        }

        input[type="range"] { appearance: none; background: transparent; height: 20px; cursor: pointer; }
        input[type="range"]::-webkit-slider-runnable-track { background: #1a1a1a; height: 4px; border-radius: 2px; }
        input[type="range"]::-webkit-slider-thumb { 
            appearance: none; height: 14px; width: 28px; 
            background: var(--accent); border-radius: 4px; 
            margin-top: -5px; transition: transform 0.1s;
        }

        .color-group { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .color-input-wrap { display: flex; align-items: center; background: #000; border: 1px solid #1a1a1a; padding: 2px 6px; }
        input[type="color"] { appearance: none; border: none; background: none; width: 20px; height: 20px; cursor: pointer; }
        .color-label { font-size: 8px; color: #666; margin-left: 5px; }

        #resizer { width: 3px; background: #111; cursor: col-resize; z-index: 10; }

        #canvas-wrap { flex-grow: 1; background: var(--bg); overflow: hidden; position: relative; min-width: 0; }
        
        #grid-canvas { width: 100%; height: 100%; }

        /* Default 模式容器：支持滚动 */
        .static-container {
            width: 100%; height: 100%; overflow-y: auto; padding: 40px 0;
            display: flex; flex-direction: column; align-items: center; gap: 15px;
            scroll-behavior: smooth;
        }
        .static-line {
            font-size: 24px; font-weight: 900; text-align: center; text-transform: uppercase;
            width: 90%; animation: blurCycle 4s ease-in-out infinite;
        }
        @keyframes blurCycle {
            0%, 100% { filter: blur(0px); opacity: 1; }
            50% { filter: blur(4px); opacity: 0.3; }
        }

        /* Kinetic 专用 */
        .stream-container { display: flex; flex-direction: column; width: 100%; height: 100%; }
        .stream-row { flex: 1; display: flex; align-items: center; white-space: nowrap; overflow: hidden; border-bottom: 0.1px solid rgba(255,255,255,0.05); }
        .stream-track { display: flex; will-change: transform; }

        /* Swiss 专用 */
        .grid-layout { display: grid; grid-template-columns: repeat(auto-fill, minmax(var(--cell-w), 1fr)); grid-auto-rows: minmax(var(--cell-h), 1fr); width: 100%; height: 100%; }

        .u { display: flex; align-items: center; justify-content: center; font-weight: 900; text-transform: uppercase; white-space: nowrap; padding: 0 10px; line-height: 1; overflow: hidden; }

        @keyframes sS { 0%, 100% { transform: scaleY(1); } 50% { transform: scaleY(var(--stretch-val)); } }
        @keyframes marqueeL { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        @keyframes marqueeR { 0% { transform: translateX(-50%); } 100% { transform: translateX(0); } }

        #export-btn { background: #fff; color: #000; border: none; padding: 10px; font-weight: 900; font-size: 9px; cursor: pointer; margin-top: 5px; transition: opacity 0.2s; }
        #export-btn:active { opacity: 0.7; }

        @media (max-width: 900px) {
            #app-body { flex-direction: column; }
            #panel { width: 100% !important; height: 40vh; border-right: none; border-bottom: 1px solid #111; }
            .p-scroll { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 12px; }
            .full { grid-column: span 2; }
        }
    </style>
</head>
<body class="global-font">

    <nav id="navbar">
        <div id="nav-left"><button id="toggle-btn" onclick="toggleP()">✕</button></div>
        <div id="nav-right"><span class="nav-version">BABEL_GEN_v5.2</span></div>
    </nav>

    <div id="app-body">
        <aside id="panel">
            <div class="p-scroll">
                <div class="item full">
                    <label>CORE_INPUT</label>
                    <textarea id="in-text" rows="2">There are as many languages as there are people in the world.</textarea>
                    <div id="status-bar"><div id="st-dot" class="active"></div><span id="st-text">READY</span></div>
                </div>
                <div class="item full">
                    <label>PRESET</label>
                    <select id="in-mode">
                        <option value="default" selected>Static List (Default)</option>
                        <option value="swiss">Swiss Vertical</option>
                        <option value="kinetic">Kinetic Warp (Stream Engine)</option>
                    </select>
                </div>
                <div class="item ctrl-node">
                    <label id="label-stretch">STRETCH <span>1</span></label>
                    <input type="range" id="in-stretch" min="0.1" max="1.0" step="0.05" value="1">
                </div>
                <div class="item ctrl-node">
                    <label id="label-font">SCALE <span>2</span></label>
                    <input type="range" id="in-font" min="0.2" max="5.0" step="0.1" value="2">
                </div>
                <div class="item ctrl-node">
                    <label id="label-rows">DENSITY <span>200</span></label>
                    <input type="range" id="in-rows" min="10" max="200" step="1" value="200">
                </div>
                <div class="item ctrl-node">
                    <label id="label-seed">SEED <span>1</span></label>
                    <input type="range" id="in-seed" min="1" max="100" step="1" value="1">
                </div>
                <div class="item full">
                    <label>COLOR (TEXT / BG)</label>
                    <div class="color-group">
                        <div class="color-input-wrap"><input type="color" id="in-color-text" value="#ffffff"><span class="color-label">TXT</span></div>
                        <div class="color-input-wrap"><input type="color" id="in-color-bg" value="#000000"><span class="color-label">BG</span></div>
                    </div>
                </div>
                <div class="item full">
                    <button id="export-btn" onclick="copyDynamicEmbed()">EXPORT_DYNAMIC_EMBED</button>
                </div>
            </div>
        </aside>
        
        <div id="resizer"></div>
        <main id="canvas-wrap">
            <div id="grid-canvas"></div>
        </main>
    </div>

    <script>
    (function() {
        const PRESET_CONFIGS = {
            default: {
                hideControls: true,
                colorTxt: "#ffffff",
                colorBg: "#000000"
            },
            swiss: {
                stretch: 1.0, 
                stretchMin: 0.1,
                stretchMax: 1.0,
                font: 2.0,    
                rows: 200,     
                seed: 1,      
                labelStretch: "STRETCH",
                colorTxt: "#ffffff",
                colorBg: "#000000",
                hideControls: false
            },
            kinetic: {
                stretch: 0.1, 
                stretchMin: 0.1,
                stretchMax: 10.0,
                font: 1.0,    
                rows: 60,     
                seed: 1,      
                labelStretch: "FLOW_SPEED",
                colorTxt: "#ffffff",
                colorBg: "#000000",
                hideControls: false
            }
        };

        let pool = ["Loading Babel Core..."];
        const panel = document.getElementById('panel');
        const resizer = document.getElementById('resizer');
        const canvas = document.getElementById('grid-canvas');
        const wrap = document.getElementById('canvas-wrap');
        
        let isResizing = false;

        resizer.addEventListener('mousedown', () => isResizing = true);
        window.addEventListener('mousemove', (e) => {
            if (!isResizing) return;
            if (window.innerWidth > 900) {
                panel.style.width = Math.max(200, Math.min(e.clientX, window.innerWidth * 0.7)) + 'px';
            } else {
                panel.style.height = Math.max(180, Math.min(e.clientY - 32, window.innerHeight * 0.8)) + 'px';
            }
            render();
        });
        window.addEventListener('mouseup', () => isResizing = false);

        window.toggleP = () => {
            const isC = panel.classList.toggle('collapsed');
            document.getElementById('toggle-btn').innerText = isC ? '⚙' : '✕';
            setTimeout(render, 400);
        };

        document.getElementById('in-mode').onchange = (e) => {
            const mode = e.target.value;
            const cfg = PRESET_CONFIGS[mode];
            
            // 隐藏/显示 调节轴
            const ctrlNodes = document.querySelectorAll('.ctrl-node');
            ctrlNodes.forEach(node => {
                if(cfg.hideControls) node.classList.add('hidden');
                else node.classList.remove('hidden');
            });

            if(!cfg.hideControls) {
                const sInput = document.getElementById('in-stretch');
                sInput.min = cfg.stretchMin;
                sInput.max = cfg.stretchMax;
                sInput.value = cfg.stretch;
                document.getElementById('in-font').value = cfg.font;
                document.getElementById('in-rows').value = cfg.rows;
                document.getElementById('in-seed').value = cfg.seed;
                document.getElementById('label-stretch').firstChild.textContent = cfg.labelStretch + " ";
            }
            
            document.getElementById('in-color-text').value = cfg.colorTxt;
            document.getElementById('in-color-bg').value = cfg.colorBg;

            updateLabels();
            render();
        };

        function updateLabels() {
            document.querySelector('#label-stretch span').innerText = document.getElementById('in-stretch').value;
            document.querySelector('#label-font span').innerText = document.getElementById('in-font').value;
            document.querySelector('#label-rows span').innerText = document.getElementById('in-rows').value;
            document.querySelector('#label-seed span').innerText = document.getElementById('in-seed').value;
        }

        ['in-stretch','in-font','in-seed','in-rows'].forEach(id => {
            document.getElementById(id).oninput = () => { updateLabels(); render(); };
        });
        ['in-color-text','in-color-bg'].forEach(id => {
            document.getElementById(id).oninput = render;
        });

        async function fetchL(text) {
            if(!text.trim()) return;
            document.getElementById('st-text').innerText = "TRANSLATING_40";
            document.getElementById('st-dot').classList.remove('active');
            
            try {
                const langs = [
                    'zh-CN','ja','ko','fr','de','ru','es','it','ar','hi','pt','tr','vi','pl','nl','sv','no','da','fi','el','he','id','ms','th',
                    'cs','hu','ro','sk','uk','bg','hr','lt','lv','et','sl','ga','is','sw','eo','la'
                ];
                const res = await Promise.all(langs.map(async l => {
                    const r = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${l}&dt=t&q=${encodeURI(text)}`);
                    const d = await r.json(); return d[0][0][0];
                }));
                pool = [text, ...res];
                document.getElementById('st-text').innerText = "READY (40 LANGS)";
                document.getElementById('st-dot').classList.add('active');
            } catch (e) { 
                pool = [text, "Translation Error"]; 
                document.getElementById('st-text').innerText = "ERROR";
            }
            render();
        }

        function render() {
            const mode = document.getElementById('in-mode').value;
            const stretch = parseFloat(document.getElementById('in-stretch').value);
            const fontScale = parseFloat(document.getElementById('in-font').value);
            const density = parseInt(document.getElementById('in-rows').value);
            const seed = parseInt(document.getElementById('in-seed').value);
            const txtCol = document.getElementById('in-color-text').value;
            const bgCol = document.getElementById('in-color-bg').value;

            wrap.style.backgroundColor = bgCol;
            canvas.innerHTML = '';
            
            if (mode === 'default') {
                canvas.className = 'static-container';
                canvas.style.display = 'flex';
                pool.forEach((word, idx) => {
                    const line = document.createElement('div');
                    line.className = 'static-line global-font';
                    line.style.color = txtCol;
                    // 交替动画延迟
                    line.style.animationDelay = (idx * 0.15) + 's';
                    line.innerText = word;
                    canvas.appendChild(line);
                });
            } else if (mode === 'kinetic') {
                canvas.className = 'stream-container';
                canvas.style.display = 'flex';
                const canvasH = wrap.offsetHeight;
                const cellH = canvasH / density;
                
                for (let r = 0; r < density; r++) {
                    const rowDiv = document.createElement('div');
                    rowDiv.className = 'stream-row';
                    const track = document.createElement('div');
                    track.className = 'stream-track';
                    let content = "";
                    for(let c = 0; c < 12; c++) {
                        const word = pool[(r + c + seed) % pool.length];
                        content += `<span class="u global-font" style="color:${txtCol}; font-size:${cellH * 0.8 * fontScale}px">${word}</span>`;
                    }
                    track.innerHTML = content + content;
                    const isEven = r % 2 === 0;
                    const duration = (1 / stretch) * 5 + (r % 3); 
                    track.style.animation = `${isEven ? 'marqueeL' : 'marqueeR'} ${duration}s linear infinite`;
                    rowDiv.appendChild(track);
                    canvas.appendChild(rowDiv);
                }
            } else {
                canvas.className = 'grid-layout';
                canvas.style.display = 'grid';
                const cellSize = Math.max(20, 1000 / density) * fontScale;
                canvas.style.setProperty('--cell-w', cellSize + 'px');
                canvas.style.setProperty('--cell-h', (cellSize * 0.6) + 'px');
                const totalCells = density * 5;
                for (let i = 0; i < totalCells; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'u global-font';
                    cell.innerText = pool[(i + seed) % pool.length];
                    cell.style.color = txtCol;
                    cell.style.fontSize = (cellSize * 0.4) + "px";
                    cell.style.setProperty('--stretch-val', 1 + stretch * 2);
                    const animDuration = 1.5 + (i % 5) * 0.2;
                    cell.style.animation = `sS ${animDuration}s ease-in-out infinite`;
                    canvas.appendChild(cell);
                }
            }
        }

        window.copyDynamicEmbed = () => { 
            const btn = document.getElementById('export-btn');
            btn.innerText = "COPIED_TO_CLIPBOARD";
            setTimeout(() => btn.innerText = "EXPORT_DYNAMIC_EMBED", 2000);
        };

        document.getElementById('in-text').oninput = (e) => {
            clearTimeout(window.db);
            window.db = setTimeout(() => fetchL(e.target.value), 800);
        };

        window.addEventListener('resize', render);
        // 初始化
        document.getElementById('in-mode').dispatchEvent(new Event('change'));
        fetchL(document.getElementById('in-text').value);
    })();
    </script>
</body>
</html>